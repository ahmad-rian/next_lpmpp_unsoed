// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Model untuk Role (seperti Spatie)
model Role {
  id          String           @id @default(cuid())
  name        String           @unique // e.g., "admin", "editor", "viewer"
  displayName String // e.g., "Administrator", "Editor", "Viewer"
  description String?          @db.Text
  color       String           @default("#6366f1") // Warna untuk badge
  isSystem    Boolean          @default(false) // Role bawaan sistem tidak bisa dihapus
  permissions RolePermission[]
  users       UserRole[]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([name])
}

// Model untuk Permission (seperti Spatie)
model Permission {
  id          String           @id @default(cuid())
  name        String           @unique // e.g., "users.create", "users.read", "news.publish"
  displayName String // e.g., "Create Users", "Read Users", "Publish News"
  module      String // e.g., "users", "news", "settings" - untuk grouping
  description String?          @db.Text
  roles       RolePermission[]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([name])
  @@index([module])
}

// Pivot table Role <-> Permission (many-to-many)
model RolePermission {
  id           String     @id @default(cuid())
  roleId       String
  permissionId String
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
}

// Pivot table User <-> Role (many-to-many) - User bisa punya multiple roles
model UserRole {
  id        String   @id @default(cuid())
  userId    String
  roleId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
}

model User {
  id            String     @id @default(cuid())
  name          String?
  email         String     @unique
  emailVerified DateTime?
  image         String?
  password      String?
  isActive      Boolean    @default(true)
  roles         UserRole[]
  accounts      Account[]
  sessions      Session[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model SiteConfig {
  id              String  @id @default(cuid())
  logoUnsoed      String? @db.Text // Path/URL logo UNSOED
  logoApp         String? @db.Text // Path/URL logo aplikasi
  logoDescription String? @db.Text // Detail penjelasan tentang logo
  siteName        String  @default("LPMPP UNSOED")
  tagline         String? @db.Text // Tagline LPMPP
  motto           String? @db.Text // Motto LPMPP
  headMessage     String? @db.Text // Pesan Ketua Lembaga
  visi            String? @db.Text // Visi LPMPP
  misi            String? @db.Text // Misi LPMPP
  visiUnsoed      String? @db.Text // Visi UNSOED
  misiUnsoed      String? @db.Text // Misi UNSOED
  tugas           String? @db.Text
  fungsi          String? @db.Text
  alamat          String? @db.Text
  email           String?
  instagramUrl    String?
  carouselImages  String? @db.Text // JSON array untuk gambar carousel (max 5)

  // Field tambahan untuk halaman utama
  gambarTeam     String? @db.Text // Gambar team
  gambarSlogan   String? @db.Text // Gambar slogan
  gambarTambahan String? @db.Text // Gambar tambahan

  // Detail Layanan LPMPP
  layananKami    String? @db.Text // LAYANAN KAMI description
  pelatihan      String? @db.Text // PELATIHAN description  
  pembelajaran   String? @db.Text // PEMBELAJARAN description
  penjaminanMutu String? @db.Text // PENJAMINAN MUTU description

  // Informasi dan Layanan
  informasiLayanan String? @db.Text // Informasi pelayanan dan jadwal
  gambarInformasi  String? @db.Text // Gambar untuk informasi layanan
  gambarStaff      String? @db.Text // Gambar staff pendukung
  gambarPartner    String? @db.Text // Gambar partner

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum LeadershipPosition {
  HEAD // Kepala Lembaga
  SECRETARY // Sekretaris Lembaga
}

model Leadership {
  id        String             @id @default(cuid())
  position  LeadershipPosition
  name      String
  title     String?            @db.Text // Gelar akademik
  photo     String?            @db.Text // Path/URL foto
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  @@unique([position]) // Hanya boleh ada 1 kepala dan 1 sekretaris
}

enum StaffPosition {
  SUB_COORDINATOR // Sub Koordinator
  GENERAL_STAFF // Staff Umum
  PROGRAM_DATA_INFO_STAFF // Staff Program, Data & Informasi
  DRIVER // Pengemudi
  OFFICE_ASSISTANT // Pramu Bakti
}

model Staff {
  id        String        @id @default(cuid())
  position  StaffPosition
  name      String
  title     String?       @db.Text // Gelar akademik
  photo     String?       @db.Text // Path/URL foto
  order     Int           @default(0) // Untuk ordering staff
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([position, order])
}

// Model untuk Pusat & Unit di LPMPP
model Center {
  id          String         @id @default(cuid())
  name        String // Nama pusat (misal: "Pusat Penjaminan Mutu Internal")
  slug        String         @unique // URL-friendly name
  description String?        @db.Text // Tugas dan fungsi pusat
  order       Int            @default(0) // Untuk ordering pusat
  isActive    Boolean        @default(true) // Untuk show/hide
  members     CenterMember[] // Relasi ke anggota
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([order])
}

enum CenterMemberRole {
  COORDINATOR // Koordinator Pusat
  MEMBER // Anggota/Staff
}

model CenterMember {
  id        String           @id @default(cuid())
  centerId  String
  center    Center           @relation(fields: [centerId], references: [id], onDelete: Cascade)
  role      CenterMemberRole
  name      String
  title     String?          @db.Text // Gelar akademik
  photo     String?          @db.Text // Path/URL foto
  order     Int              @default(0) // Untuk ordering anggota dalam pusat
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  @@index([centerId, role, order])
}

// Model untuk konten SPMI
model SpmiContent {
  id        String   @id @default(cuid())
  section   String // "tujuan" atau "fungsi"
  content   String   @db.Text
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([section])
}

enum DocumentType {
  SPMI // Dokumen SPMI
  AUDIT // Dokumen Audit
  REGULATION // Peraturan
}

// Model untuk dokumen (PDF/DOCS)
model Document {
  id          String       @id @default(cuid())
  type        DocumentType
  title       String
  description String?      @db.Text
  fileUrl     String       @db.Text // Path ke file
  fileName    String // Nama file original
  fileSize    Int? // Ukuran file dalam bytes
  order       Int          @default(0)
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([type, order])
}

// Model untuk Master Fakultas
model Faculty {
  id                     String                  @id @default(cuid())
  name                   String                  @unique // Nama lengkap fakultas
  shortName              String? // Singkatan fakultas
  code                   String?                 @unique // Kode fakultas
  order                  Int                     @default(0)
  isActive               Boolean                 @default(true)
  qualityAssuranceGroups QualityAssuranceGroup[] // Relasi ke GPM
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt

  @@index([order])
}

// Model untuk Gugus Penjamin Mutu
model QualityAssuranceGroup {
  id          String                     @id @default(cuid())
  facultyId   String // Foreign key ke Faculty
  faculty     Faculty                    @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  ketuaGpm    String? // Nama Ketua GPM
  description String?                    @db.Text
  contactInfo String?                    @db.Text
  directUrl   String?                    @db.Text // URL langsung ke halaman GPM fakultas
  order       Int                        @default(0)
  isActive    Boolean                    @default(true)
  documents   QualityAssuranceDocument[] // Relasi ke dokumen GPM
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt

  @@index([facultyId])
  @@index([order])
}

// Model untuk dokumen GPM
model QualityAssuranceDocument {
  id        String                @id @default(cuid())
  groupId   String
  group     QualityAssuranceGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  title     String
  fileUrl   String                @db.Text // Path ke file
  fileName  String // Nama file original
  fileSize  Int? // Ukuran file dalam bytes
  order     Int                   @default(0)
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt

  @@index([groupId, order])
}

// Model untuk Sistem Informasi Pendukung SPMI
model SpmiInformationSystem {
  id          String   @id @default(cuid())
  name        String // Nama sistem informasi
  shortName   String? // Singkatan/akronim
  description String?  @db.Text // Deskripsi sistem
  logoUrl     String?  @db.Text // URL logo aplikasi
  websiteUrl  String?  @db.Text // URL website sistem informasi
  category    String? // Kategori sistem (e.g., "Akademik", "Kepegawaian", "Keuangan")
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([order])
  @@index([isActive])
  @@index([category])
}

// Enum untuk lembaga pemeringkat PT
enum RankingInstitution {
  WEBOMETRICS
  QS
  APPLIEDHE
  THE_WUR
  SCOPUS
}

// Model untuk Peringkat Perguruan Tinggi berdasarkan Lembaga
model UniversityRanking {
  id           String             @id @default(cuid())
  institution  RankingInstitution // Lembaga pemeringkat
  year         Int // Tahun pemeringkatan
  rankNational Int? // Peringkat nasional
  rankWorld    Int? // Peringkat dunia
  rankAsia     Int? // Peringkat asia (opsional)
  score        Float? // Skor (jika ada)
  badge        String? // Badge/kategori (e.g., "Rising Star", "Impact Rankings")
  description  String?            @db.Text // Deskripsi tambahan
  sourceUrl    String?            @db.Text // URL sumber
  logoUrl      String?            @db.Text // Logo lembaga
  isActive     Boolean            @default(true)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  @@unique([institution, year])
  @@index([institution])
  @@index([year])
  @@index([isActive])
}

enum AccreditationLevel {
  D3 // D-III
  PROFESI // Profesi
  S1 // S1
  S2 // S2
  S3 // S3
  SPESIALIS // Spesialis
}

enum AccreditationRank {
  UNGGUL // Unggul
  BAIK_SEKALI // Baik Sekali
  BAIK // Baik
  TERAKREDITASI_SEMENTARA // Terakreditasi Sementara
  A // A
  B // B
  C // C
}

// Model untuk Akreditasi Internasional
model InternationalAccreditation {
  id                String   @id @default(cuid())
  faculty           String // Nama Fakultas
  studyProgram      String // Program Studi
  accreditationBody String   @db.Text // Lembaga Akreditasi
  order             Int      @default(0) // Urutan tampilan
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([order])
  @@index([isActive])
}

// Model untuk Akreditasi Program Studi
model StudyProgramAccreditation {
  id             String             @id @default(cuid())
  studyProgram   String // Nama Program Studi
  level          AccreditationLevel // Strata (D-III, S1, S2, S3, Profesi, Spesialis)
  korprodi       String? // Nama Koordinator Program Studi
  skNumber       String? // Nomor SK
  skYear         Int? // Tahun SK
  rank           AccreditationRank? // Peringkat
  validFrom      DateTime? // Tanggal mulai berlaku
  validUntil     DateTime? // Tanggal selesai berlaku
  certificateUrl String?            @db.Text // URL dokumen sertifikat akreditasi
  order          Int                @default(0) // Urutan tampilan
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  @@index([level])
  @@index([rank])
  @@index([order])
  @@index([isActive])
}

// Model untuk Akreditasi Perguruan Tinggi
model UniversityAccreditation {
  id          String                            @id @default(cuid())
  title       String
  description String?                           @db.Text
  imageUrl    String?                           @db.Text // Single image banner
  isActive    Boolean                           @default(true)
  documents   UniversityAccreditationDocument[] // Multiple documents
  createdAt   DateTime                          @default(now())
  updatedAt   DateTime                          @updatedAt
}

// Model untuk Dokumen Akreditasi Perguruan Tinggi (Multiple)
model UniversityAccreditationDocument {
  id              String                  @id @default(cuid())
  accreditationId String
  accreditation   UniversityAccreditation @relation(fields: [accreditationId], references: [id], onDelete: Cascade)
  title           String // Nama dokumen (misal: "SK Akreditasi 2024")
  documentUrl     String                  @db.Text // PDF/DOC file URL
  documentName    String? // Original filename
  order           Int                     @default(0)
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  @@index([accreditationId, order])
}

// Model untuk Program Unggulan
model FeaturedProgram {
  id           String   @id @default(cuid())
  title        String // Nama program (e.g., "Pembelajaran di Luar Kampus (MBKM)")
  slug         String   @unique // URL-friendly identifier (e.g., "mbkm")
  description  String?  @db.Text // Konten/deskripsi program
  documentUrl  String?  @db.Text // Link ke dokumen/peraturan (optional)
  documentName String? // Nama file dokumen (optional)
  icon         String? // Icon identifier untuk UI (optional)
  order        Int      @default(0) // Urutan tampilan
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([order])
}

// Enum untuk tipe kepakaran
enum ExpertiseType {
  FASILITATOR_PEKERTI // Fasilitator Pekerti/AA
  AUDITOR_SPMI // Auditor SPMI
  ASESOR_BKD // Asesor BKD
  ASESOR_SERDOS // Asesor Serdos
}

// Model untuk Kepakaran (Fasilitator, Auditor, Asesor)
model Expertise {
  id         String        @id @default(cuid())
  type       ExpertiseType // Jenis kepakaran
  name       String // Nama lengkap dengan gelar
  profileUrl String?       @db.Text // Link profile (SINTA, Google Scholar, dll)
  order      Int           @default(0) // Nomor urut
  isActive   Boolean       @default(true)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@index([type, order])
}

// Model untuk Tautan/Link
model Link {
  id        String   @id @default(cuid())
  name      String // Nama tautan (e.g., "SAPTO 2", "BAN-PT")
  url       String   @db.Text // URL tautan
  order     Int      @default(0) // Nomor urut
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
}

// Model untuk Berita/News
model News {
  id            String   @id @default(cuid())
  title         String   @db.Text // Judul berita
  slug          String   @unique // URL-friendly slug
  excerpt       String   @db.Text // Ringkasan/kutipan berita
  content       String   @db.LongText // Isi berita lengkap (HTML dari editor)
  coverImage    String?  @db.Text // Path/URL gambar cover
  galleryImages String?  @db.Text // JSON array of gallery image URLs (ditampilkan sebelum content)
  author        String // Nama penulis (e.g., "Admin LP3M")
  publishedAt   DateTime @default(now()) // Tanggal publikasi
  isPublished   Boolean  @default(false) // Status publikasi
  viewCount     Int      @default(0) // Jumlah views
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([slug])
  @@index([publishedAt])
  @@index([isPublished])
}

model Download {
  id            String   @id @default(cuid())
  name          String   @db.Text // Nama dokumen
  description   String?  @db.Text // Deskripsi dokumen (opsional)
  fileUrl       String   @db.Text // URL file PDF/DOCS
  fileType      String // pdf, doc, docx, dll
  fileSize      Int // Ukuran file dalam bytes
  downloadCount Int      @default(0) // Jumlah download
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([name(length: 191)])
  @@index([createdAt])
}

// Model untuk Data Buku
model DataBuku {
  id        String   @id @default(cuid())
  judul     String   @db.Text // Judul buku
  deskripsi String?  @db.Text // Deskripsi buku
  gambar    String?  @db.Text // Path/URL gambar cover buku (auto convert ke WebP)
  link      String?  @db.Text // Link ke buku (URL eksternal atau download)
  order     Int      @default(0) // Urutan tampilan
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
  @@index([isActive])
}

// Model untuk Data Galeri
model DataGaleri {
  id        String   @id @default(cuid())
  judul     String?  @db.Text // Judul/caption foto (opsional)
  gambar    String   @db.Text // Path/URL gambar (auto convert ke WebP)
  deskripsi String?  @db.Text // Deskripsi foto (opsional)
  order     Int      @default(0) // Urutan tampilan
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
  @@index([isActive])
}

// Model untuk Tautan Layanan (berisi Gambar dan Link)
model TautanLayanan {
  id        String   @id @default(cuid())
  nama      String // Nama layanan
  gambar    String?  @db.Text // Path/URL gambar layanan (auto convert ke WebP)
  link      String   @db.Text // URL link layanan
  deskripsi String?  @db.Text // Deskripsi layanan (opsional)
  order     Int      @default(0) // Urutan tampilan
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
  @@index([isActive])
}

// Model untuk Tentang SPMI
model SpmiAbout {
  id        String   @id @default(cuid())
  title     String   @default("SPM Unsoed")
  tujuan    String   @db.Text // Tujuan SPMI
  fungsi    String   @db.Text // Fungsi SPMI
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Model untuk Agenda Kegiatan
model Agenda {
  id          String   @id @default(cuid())
  title       String   @db.Text // Judul kegiatan
  date        DateTime // Tanggal kegiatan
  startTime   String // Waktu mulai (format: HH:mm)
  endTime     String // Waktu selesai (format: HH:mm)
  location    String   @db.Text // Lokasi kegiatan
  description String?  @db.Text // Deskripsi kegiatan (opsional)
  color       String   @default("#f59e0b") // Warna untuk display (default: orange)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date])
  @@index([isActive])
}
